containers:
  default:
    anka: macos-xcode10.3:latest

steps:
  - label: Build TruffleRuby on MacOS
    timeout: 90m
    artifact_paths:
    - truffle/artifacts
    run:
    - brew install openssl llvm@4
    - cd truffle
    - ./build-macos.sh
  - wait
  - label: Run Ruby specs
    timeout: 30m
    import_artifacts:
    - pattern: '*.tar.gz'
      into: archive
    run:
      - truffle/test-specs.sh
  - label: Run Liquid tests
    timeout: 30m
    import_artifacts:
    - pattern: '*.tar.gz'
      into: archive
    run:
      - truffle/test-liquid.sh
